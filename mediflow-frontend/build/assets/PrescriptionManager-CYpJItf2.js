import{j as e}from"./vendor-ui-U3Ba6Q2R.js";import{a as s}from"./vendor-react-BE6zuAE5.js";import{p as t,C as a,r as n,s as i,w as r,v as c,L as d,S as o,a as l,b as m,d as x,e as p,B as h,I as j,q as g,t as u,G as f,H as N,D as y,x as w,i as b,j as v,k as D,l as C,J as P,K as S,A as $,n as L,M as A,N as k,m as U}from"./dashboard-DtoPNkNb.js";import{T as I}from"./appointments-Dg7vZs4t.js";import{U as _,L as F,b as q,m as E,B as M,Q as R,F as T,$ as z,T as O,c as B,a as G}from"./vendor-icons-MnWTdEGO.js";import"./vendor-utils-DkKPvr0p.js";const V=({onSuccess:y,onCancel:w,prescription:b})=>{const{user:v}=t(),[D,C]=s.useState(!1),[P,S]=s.useState(!0),[$,L]=s.useState([]),[A,k]=s.useState({appointment:"",patient:"",medicines:[{name:"",dosage:"",duration:""}],notes:""}),U=!!b;s.useEffect(()=>{if(b){const e="object"==typeof b.appointment?b.appointment._id:b.appointment,s="object"==typeof b.patient?b.patient._id:b.patient;k({appointment:e||"",patient:s||"",medicines:b.medicines||b.medications||[{name:"",dosage:"",duration:""}],notes:b.notes||""})}},[b]),s.useEffect(()=>{"doctor"===v?.role?.toLowerCase()&&(async()=>{try{S(!0);const e=((await g()).data||[]).filter(e=>"confirmed"===e.status||"completed"===e.status);L(e)}catch(e){u.error("Failed to load appointments")}finally{S(!1)}})()},[v]);const z=(e,s,t)=>{const a=[...A.medicines];a[e][s]=t,k({...A,medicines:a})},O=$.find(e=>e._id===A.appointment);return e.jsxs("form",{onSubmit:async e=>{e.preventDefault();const s=A.medicines.filter(e=>e.name&&e.dosage&&e.duration);if(0!==s.length)try{if(C(!0),U&&b)await f(b._id||b.id,{medicines:s,notes:A.notes}),u.success("Prescription updated successfully!");else{if(!A.appointment||!A.patient)return void u.error("Please select an appointment");await N({appointment:A.appointment,patient:A.patient,medicines:s,notes:A.notes}),u.success("Prescription created successfully!")}k({appointment:"",patient:"",medicines:[{name:"",dosage:"",duration:""}],notes:""}),y&&y()}catch(t){u.error(t.response?.data?.msg||"Failed to create prescription")}finally{C(!1)}else u.error("Please add at least one medicine")},className:"space-y-6",children:[!U&&e.jsxs(a,{children:[e.jsxs(n,{children:[e.jsxs(i,{className:"flex items-center text-emerald-700 mt-4",children:[e.jsx(_,{className:"h-5 w-5 mr-2"}),"Patient & Appointment"]}),e.jsx(r,{children:"Select the appointment for this prescription"})]}),e.jsxs(c,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:"appointment",children:"Appointment *"}),P?e.jsxs("div",{className:"flex items-center py-2",children:[e.jsx(F,{className:"h-4 w-4 animate-spin mr-2"}),"Loading appointments..."]}):e.jsxs(o,{value:A.appointment,onValueChange:e=>{const s=$.find(s=>s._id===e);s&&k({...A,appointment:e,patient:"object"==typeof s.patientId?s.patientId._id:s.patientId})},children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Select an appointment"})}),e.jsxs(x,{children:[$.map(s=>{const t="object"==typeof s.patientId?s.patientId:null,a=t?.name||"Unknown Patient",n=new Date(s.date).toLocaleDateString();return e.jsx(p,{value:s._id,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),a," - ",n]})},s._id)}),0===$.length&&e.jsx(p,{value:"none",disabled:!0,children:"No confirmed appointments available"})]})]})]}),O&&e.jsxs("div",{className:"p-3 bg-emerald-50 border border-emerald-200 rounded-lg",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Patient:"})," ","object"==typeof O.patientId?O.patientId.name:"Unknown"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Date:"})," ",new Date(O.date).toLocaleString()]}),O.reason&&e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"Reason:"})," ",O.reason]})]})]})]}),e.jsxs(a,{children:[e.jsxs(n,{children:[e.jsxs(i,{className:"flex items-center justify-between text-emerald-700 mt-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Medicines"]}),e.jsxs(h,{type:"button",onClick:()=>{k({...A,medicines:[...A.medicines,{name:"",dosage:"",duration:""}]})},size:"sm",variant:"outline",className:"border-emerald-600 text-emerald-600 hover:bg-emerald-50",children:[e.jsx(M,{className:"h-4 w-4 mr-1"}),"Add Medicine"]})]}),e.jsx(r,{children:"Add medicines with dosage and duration"})]}),e.jsxs(c,{className:"space-y-4",children:[A.medicines.map((s,t)=>e.jsxs("div",{className:"p-4 border border-gray-200 rounded-lg space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-medium text-sm",children:["Medicine ",t+1]}),A.medicines.length>1&&e.jsx(h,{type:"button",onClick:()=>(e=>{const s=A.medicines.filter((s,t)=>t!==e);k({...A,medicines:s})})(t),size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:e.jsx(R,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[e.jsxs("div",{children:[e.jsx(d,{htmlFor:`medicine-name-${t}`,children:"Medicine Name *"}),e.jsx(j,{id:`medicine-name-${t}`,value:s.name,onChange:e=>z(t,"name",e.target.value),placeholder:"e.g., Paracetamol",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:`medicine-dosage-${t}`,children:"Dosage *"}),e.jsx(j,{id:`medicine-dosage-${t}`,value:s.dosage,onChange:e=>z(t,"dosage",e.target.value),placeholder:"e.g., 500mg twice daily",required:!0})]}),e.jsxs("div",{children:[e.jsx(d,{htmlFor:`medicine-duration-${t}`,children:"Duration *"}),e.jsx(j,{id:`medicine-duration-${t}`,value:s.duration,onChange:e=>z(t,"duration",e.target.value),placeholder:"e.g., 7 days",required:!0})]})]})]},t)),0===A.medicines.length&&e.jsx("p",{className:"text-center text-gray-500 py-4",children:'No medicines added. Click "Add Medicine" to start.'})]})]}),e.jsxs(a,{children:[e.jsxs(n,{children:[e.jsxs(i,{className:"flex items-center text-emerald-700 mt-4",children:[e.jsx(T,{className:"h-5 w-5 mr-2"}),"Additional Notes"]}),e.jsx(r,{children:"Any special instructions or notes"})]}),e.jsx(c,{children:e.jsx(I,{value:A.notes,onChange:e=>k({...A,notes:e.target.value}),placeholder:"Enter any additional notes, instructions, or precautions...",rows:4})})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[w&&e.jsx(h,{type:"button",variant:"outline",onClick:w,children:"Cancel"}),e.jsx(h,{type:"submit",disabled:D,className:"bg-emerald-600 hover:bg-emerald-700 text-gray-300",variant:"outline",children:D?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2 animate-spin"}),U?"Updating...":"Creating..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),U?"Update Prescription":"Create Prescription"]})})]})]})},H=()=>{const{user:d}=t(),[o,l]=s.useState(null),[m,x]=s.useState(!1),[p,j]=s.useState([]),[g,f]=s.useState(!0),[N,I]=s.useState(null);s.useEffect(()=>{d&&(async()=>{try{f(!0);const e=await A(),s=Array.isArray(e.data)?e.data:[];j(s)}catch(e){u.error("Failed to load prescriptions");const s=k.filter(e=>"doctor"===d?.role?.toLowerCase()?e.doctorId===d.id:"patient"===d?.role?.toLowerCase()&&e.patientId===d.id);j(s)}finally{f(!1)}})()},[d]);const R=e=>{try{const s="object"==typeof e.patient?e.patient:{name:"Unknown Patient"},t="object"==typeof e.doctor?e.doctor:{name:"Unknown Doctor"},a=e.medicines||e.medications||[];let n="PRESCRIPTION\n";n+=`${"=".repeat(50)}\n\n`,n+=`Date: ${new Date(e.createdAt||e.date).toLocaleDateString()}\n`,n+=`Patient: ${s.name||"Unknown"}\n`,n+=`Doctor: Dr. ${t.name||"Unknown"}\n`,t.specialization&&(n+=`Specialization: ${t.specialization}\n`),n+=`\n${"=".repeat(50)}\n\n`,e.diagnosis&&(n+=`DIAGNOSIS:\n${e.diagnosis}\n\n`),n+="MEDICATIONS:\n",n+=`${"-".repeat(50)}\n`,a.forEach((e,s)=>{n+=`\n${s+1}. ${e.name}\n`,n+=`   Dosage: ${e.dosage}\n`,e.frequency&&(n+=`   Frequency: ${e.frequency}\n`),n+=`   Duration: ${e.duration}\n`,e.instructions&&(n+=`   Instructions: ${e.instructions}\n`)}),e.notes&&(n+=`\n${"=".repeat(50)}\n`,n+=`NOTES:\n${e.notes}\n`),n+=`\n${"=".repeat(50)}\n`,n+="\nThis is a digitally generated prescription.\n";const i=new Blob([n],{type:"text/plain"}),r=window.URL.createObjectURL(i),c=document.createElement("a");c.href=r,c.download=`prescription_${s.name?.replace(/\s+/g,"_")}_${(new Date).getTime()}.txt`,document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(r),u.success("Prescription downloaded successfully!")}catch(s){u.error("Failed to download prescription")}},H=[...p].sort((e,s)=>new Date(s.createdAt||s.date).getTime()-new Date(e.createdAt||e.date).getTime()),J=o?p.find(e=>e._id===o||e.id===o):null,K=s=>{const t=new Date(s.createdAt||s.date),a=new Date,n=Math.floor((a.getTime()-t.getTime())/864e5);return n<=7?e.jsxs(U,{className:"bg-green-100 text-green-800 flex items-center",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Recent"]}):n<=30?e.jsxs(U,{className:"bg-blue-100 text-blue-800 flex items-center",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsxs(U,{className:"bg-gray-100 text-gray-700 flex items-center",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Expired"]})};return e.jsxs("div",{className:"space-y-6 p-6 bg-gradient-to-b from-gray-50 to-gray-100 min-h-screen",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold text-green-700 flex items-center",children:[e.jsx(E,{className:"h-7 w-7 text-green-600 mr-2"}),"patient"===d?.role?.toLowerCase()?"My Prescriptions":"Prescription Management"]}),e.jsx("p",{className:"text-gray-500 mt-1",children:"patient"===d?.role?.toLowerCase()?"View your current and past prescriptions":"Create, track, and manage patient prescriptions"})]}),"doctor"===d?.role?.toLowerCase()&&e.jsxs(y,{open:m,onOpenChange:e=>{x(e),e||I(null)},children:[e.jsx(w,{asChild:!0,children:e.jsxs(h,{className:"flex items-center bg-green-600 text-white hover:bg-green-700 shadow-md mt-4 md:mt-0",children:[e.jsx(M,{className:"mr-2 h-4 w-4"}),"New Prescription"]})}),e.jsxs(b,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(v,{children:[e.jsxs(D,{className:"flex items-center text-xl text-emerald-700",children:[e.jsx(E,{className:"mr-2 h-5 w-5"}),N?"Edit Prescription":"Create New Prescription"]}),e.jsx(C,{children:N?"Update medications and instructions":"Add medications and instructions for your patient"})]}),e.jsx(V,{prescription:N,onSuccess:()=>{x(!1),I(null),(async()=>{try{const e=await A(),s=Array.isArray(e.data)?e.data:[];j(s)}catch(e){}})()},onCancel:()=>{x(!1),I(null)}})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(a,{className:"shadow-md border border-gray-200 rounded-xl overflow-hidden",children:[e.jsxs(n,{className:"bg-green-50 rounded-t-xl p-4",children:[e.jsxs(i,{className:"flex items-center text-green-900",children:[e.jsx(E,{className:"h-6 w-6 text-green-600 mr-2"}),"Medical Prescriptions"]}),e.jsx(r,{className:"text-green-700",children:g?"Loading...":`${H.length} total prescriptions`})]}),e.jsxs(c,{className:"p-4 space-y-4",children:[g?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(F,{className:"h-8 w-8 animate-spin text-green-600"})}):H.map(s=>{const t="object"==typeof s.patient&&null!==s.patient?s.patient:P.find(e=>e.id===s.patient||e._id===s.patient),a="object"==typeof s.doctor&&null!==s.doctor?s.doctor:S.find(e=>e.id===s.doctor||e._id===s.doctor),n=s._id||s.id,i=o===n;return e.jsx("div",{className:"p-4 border rounded-xl cursor-pointer transition-all duration-300 shadow-sm hover:shadow-md transform hover:scale-[1.01] "+(i?"border-blue-500 bg-blue-50":"border-gray-200 hover:bg-gray-50"),onClick:()=>l(n),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(E,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:s.diagnosis||s.notes?.substring(0,50)||"Prescription"}),K(s)]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(_,{className:"h-3 w-3 mr-1"}),"patient"===d?.role?.toLowerCase()?`Dr. ${a?.name||"Unknown"}`:t?.name||"Unknown Patient"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),new Date(s.createdAt||s.date).toLocaleDateString()]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),s.medicines?.length||s.medications?.length||0," meds"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end space-y-2",children:[s.followUpDate&&e.jsxs("div",{className:"text-xs text-center",children:[e.jsx("div",{className:"text-gray-400",children:"Follow-up"}),e.jsx("div",{className:"font-medium text-gray-700",children:new Date(s.followUpDate).toLocaleDateString()})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(h,{size:"sm",variant:"outline",className:"flex items-center",onClick:e=>{e.stopPropagation(),R(s)},children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"PDF"]}),"doctor"===d?.role?.toLowerCase()&&e.jsx(h,{size:"sm",variant:"outline",className:"flex items-center",onClick:e=>{e.stopPropagation(),(e=>{I(e),x(!0)})(s)},children:"Edit"})]})]})]})},n)}),!g&&0===H.length&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(T,{className:"mx-auto h-12 w-12 mb-4"}),e.jsx("p",{children:"patient"===d?.role?.toLowerCase()?"No prescriptions found":"No prescriptions created yet"})]})]})]})}),e.jsx("div",{className:"lg:col-span-1",children:J?e.jsxs(a,{className:"shadow-lg rounded-xl border border-gray-200 animate-fadeIn",children:[e.jsxs(n,{className:"p-4 border-b border-gray-200",children:[e.jsxs(i,{className:"flex items-center text-gray-800",children:[e.jsx(T,{className:"mr-2 h-5 w-5 text-green-600"}),"Prescription Details"]}),e.jsx(r,{className:"text-gray-500",children:new Date(J.createdAt||J.date).toLocaleDateString()})]}),e.jsxs(c,{className:"space-y-4 p-4",children:[(J.diagnosis||J.notes)&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-700 text-sm mb-2",children:J.diagnosis?"Diagnosis":"Notes"}),e.jsx("p",{className:"text-sm p-3 bg-green-50 rounded border-l-4 border-green-400",children:J.diagnosis||J.notes})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-700 text-sm mb-2",children:"Prescribed By"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-8 w-8 ring-2 ring-green-400",children:e.jsx(L,{className:"bg-green-100 text-green-700 font-bold",children:(()=>{const e="object"==typeof J.doctor&&null!==J.doctor?J.doctor:S.find(e=>e.id===J.doctor||e._id===J.doctor);return e?.name?.split(" ").map(e=>e[0]).join("")||"DR"})()})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium text-gray-800",children:["Dr. ",(()=>{const e="object"==typeof J.doctor&&null!==J.doctor?J.doctor:S.find(e=>e.id===J.doctor||e._id===J.doctor);return e?.name||"Unknown Doctor"})()]}),e.jsx("p",{className:"text-xs text-gray-500",children:(()=>{const e="object"==typeof J.doctor&&null!==J.doctor?J.doctor:S.find(e=>e.id===J.doctor||e._id===J.doctor);return e?.specialization||"General Practitioner"})()})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-700 text-sm mb-2",children:"Medications"}),e.jsx("div",{className:"space-y-2",children:(J.medicines||J.medications||[]).map((s,t)=>e.jsxs("div",{className:"p-3 border rounded-lg bg-gray-50 hover:bg-gray-100 transition",children:[e.jsx("div",{className:"font-medium text-gray-800",children:s.name}),e.jsxs("div",{className:"text-xs text-gray-500 space-y-1 mt-1",children:[e.jsxs("div",{children:["ðŸ’Š Dosage: ",s.dosage]}),s.frequency&&e.jsxs("div",{children:["â° Frequency: ",s.frequency]}),e.jsxs("div",{children:["ðŸ“… Duration: ",s.duration]}),s.instructions&&e.jsxs("div",{className:"text-blue-600",children:["ðŸ“Œ ",s.instructions]})]})]},t))})]}),J.diagnosis&&J.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-700 text-sm mb-2",children:"Additional Notes"}),e.jsxs("p",{className:"text-sm p-3 bg-yellow-50 rounded border-l-4 border-yellow-400 flex items-center",children:[e.jsx(O,{className:"h-4 w-4 mr-2 text-yellow-600"}),J.notes]})]}),J.followUpDate&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-700 text-sm mb-2",children:"Follow-up Date"}),e.jsxs("div",{className:"flex items-center text-sm p-3 bg-blue-50 rounded",children:[e.jsx(B,{className:"h-4 w-4 mr-2 text-blue-600"}),new Date(J.followUpDate).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex space-x-2 pt-4",children:[e.jsxs(h,{className:"flex-1 flex items-center justify-center bg-green-600 text-white hover:bg-green-700 shadow-md",onClick:()=>R(J),children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Download PDF"]}),"patient"===d?.role?.toLowerCase()&&e.jsxs(h,{variant:"outline",className:"flex-1 flex items-center justify-center",onClick:()=>u.info("Request refill functionality coming soon!"),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Request Refill"]})]})]})]}):e.jsx(a,{className:"shadow-md rounded-xl border border-gray-200 h-64 flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(T,{className:"mx-auto h-12 w-12 mb-4"}),e.jsx("p",{children:"Select a prescription to view details"})]})})})]})]})};export{H as PrescriptionManager};
